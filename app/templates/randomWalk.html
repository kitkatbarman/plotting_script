<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Walk</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #control-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }

        .control-button {
            margin: 10px;
            flex: 1 1 100px; /* Flexible and minimum width */
        }

        .control-label {
            margin: 10px;
            flex: 1 1 100px; /* Flexible and minimum width */
        }

        #canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 100px); /* Adjust based on the height of control panel */
        }

        canvas {
            border: 1px solid black; /* Optional: to visualize the canvas border */
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 600px) {
            #control-panel {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div id="control-panel">
        <button id="start-button" class="control-button">Start</button>
        <button id="pause-button" class="control-button">Pause</button>
        <button id="stop-button" class="control-button">Stop</button>
        <label class="control-label"><input type="checkbox" id="follow-walk"> Follow Walk</label>
        <label class="control-label">
            Shape:
            <select id="shape-selector">
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
                <option value="triangle">Triangle</option>
            </select>
        </label>
        <label class="control-label"><input type="checkbox" id="fractal-walk"> Fractal Walk</label>
        <label class="control-label">Fractal Steps: <input type="range" id="fractal-steps" min="10" max="200" value="30"></label>
        <label class="control-label">Randomness: <input type="range" id="randomness-slider" min="0" max="100" value="0"></label>
        <label class="control-label">Speed: <input type="range" id="speed-slider" min="0" max="100" value="50"></label>
        <label class="control-label">Line Thickness: <input type="range" id="line-thickness-slider" min="1" max="10" value="2"></label>
    </div>
    <div id="canvas-container">
        <!-- The canvas will be inserted here by p5.js -->
    </div>
    <p>Static URL: {{ url_for('static', filename='js/randomWalker.js') }}</p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script src="{{ url_for('static', filename='js/randomWalker.js') }}"></script>
    <script>
        let scale = 1.0;
        let lastTouchEnd = 0;
        let initialDistance = 0;
        let initialScale = 1.0;

        function setup() {
            createCanvas(windowWidth, windowHeight).parent('canvas-container');
            pathPoints.push({ x: currentLocation.x, y: currentLocation.y });
            frameRate(10); // Start with a default speed
            canvas.addEventListener('wheel', handleWheel);
            canvas.addEventListener('touchstart', handleTouchStart, false);
            canvas.addEventListener('touchmove', handleTouchMove, false);
            canvas.addEventListener('touchend', handleTouchEnd, false);
        }

        function draw() {
            background(255);
            translate(translateX, translateY);
            scale(scale);

            stroke(0);
            strokeWeight(2);

            for (let i = 1; i < pathPoints.length; i++) {
                line(pathPoints[i - 1].x, pathPoints[i - 1].y, pathPoints[i].x, pathPoints[i].y);
            }

            if (timer) {
                moveRandomly();
            }
            
            adjustView();
        }

        function handleWheel(event) {
            event.preventDefault();
            let delta = event.deltaY > 0 ? 0.9 : 1.1;
            scale *= delta;
            translateX = (translateX - event.clientX) * delta + event.clientX;
            translateY = (translateY - event.clientY) * delta + event.clientY;
        }

        function handleTouchStart(event) {
            if (event.touches.length === 2) {
                initialDistance = getDistance(event.touches[0], event.touches[1]);
                initialScale = scale;
            }
        }

        function handleTouchMove(event) {
            if (event.touches.length === 2) {
                let currentDistance = getDistance(event.touches[0], event.touches[1]);
                let delta = currentDistance / initialDistance;
                scale = initialScale * delta;
            }
        }

        function handleTouchEnd(event) {
            let now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }

        function getDistance(touch1, touch2) {
            return Math.sqrt(Math.pow(touch2.clientX - touch1.clientX, 2) + Math.pow(touch2.clientY - touch1.clientY, 2));
        }

        document.getElementById('start-button').addEventListener('click', () => {
            timer = true;
            loop();
        });

        document.getElementById('pause-button').addEventListener('click', () => {
            timer = false;
            noLoop();
        });

        document.getElementById('stop-button').addEventListener('click', () => {
            timer = false;
            pathPoints = [{ x: 400, y: 400 }];
            currentLocation = { x: 400, y: 400 };
            translateX = 0;
            translateY = 0;
            noLoop();
            redraw();
        });

        document.getElementById('follow-walk').addEventListener('change', (e) => {
            followWalk = e.target.checked;
        });

        document.getElementById('shape-selector').addEventListener('change', (e) => {
            let selectedShape = e.target.value;
            switch (selectedShape) {
                case 'rectangle':
                    // Handle rectangle shape
                    break;
                case 'circle':
                    // Handle circle shape
                    break;
                case 'triangle':
                    // Handle triangle shape
                    break;
            }
        });

        document.getElementById('fractal-walk').addEventListener('change', (e) => {
            useFractalStepSize = e.target.checked;
        });

        document.getElementById('fractal-steps').addEventListener('input', (e) => {
            fractalSteps = e.target.value;
        });

        document.getElementById('randomness-slider').addEventListener('input', (e) => {
            randomnessLevel = e.target.value;
        });

        document.getElementById('speed-slider').addEventListener('input', (e) => {
            let speed = e.target.value;
            frameRate(map(speed, 0, 100, 1, 60));
        });

        document.getElementById('line-thickness-slider').addEventListener('input', (e) => {
            let thickness = e.target.value;
            strokeWeight(thickness);
        });
    </script>
</body>
</html>

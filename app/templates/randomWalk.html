<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Walk</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        #control-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }

        .control-button {
            margin: 10px;
            flex: 1 1 100px; /* Flexible and minimum width */
        }

        .control-label {
            margin: 10px;
            flex: 1 1 100px; /* Flexible and minimum width */
        }

        #canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 100px); /* Adjust based on the height of control panel */
        }

        canvas {
            border: 1px solid black; /* Optional: to visualize the canvas border */
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 600px) {
            #control-panel {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div id="control-panel">
        <button id="start-button" class="control-button">Start</button>
        <button id="stop-button" class="control-button">Stop</button>
        <label class="control-label"><input type="checkbox" id="follow-walk"> Follow Walk</label>
        <label class="control-label">Speed: <input type="range" id="speed-slider" min="0" max="100" value="50"></label>
    </div>
    <div id="canvas-container">
        <!-- The canvas will be inserted here by p5.js -->
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
        let pathPoints = [];
        let currentLocation = { x: 400, y: 400 };
        let scaleFactor = 1.0;
        let translateX = 0;
        let translateY = 0;
        let initialDistance = 0;
        let initialScale = 1.0;
        let isPinching = false;
        let lastTouches = [];
        let timer = false; // Initialize timer variable

        function setup() {
            let canvas = createCanvas(800, 800);
            canvas.parent('canvas-container');
            pathPoints.push({ x: currentLocation.x, y: currentLocation.y });
            frameRate(10); // Start with a default speed
            console.log("Canvas setup completed."); // Debugging step
        }

        function draw() {
            background(255);
            translate(translateX, translateY);
            scale(scaleFactor);

            stroke(0);
            strokeWeight(2);

            for (let i = 1; i < pathPoints.length; i++) {
                line(pathPoints[i - 1].x, pathPoints[i - 1].y, pathPoints[i].x, pathPoints[i].y);
            }

            if (timer) {
                moveRandomly(); // Assuming moveRandomly is defined in randomWalker.js
            }

            console.log("Drawing frame."); // Debugging step
        }

        function touchStarted() {
            if (touches.length === 2) {
                isPinching = true;
                initialDistance = dist(touches[0].x, touches[0].y, touches[1].x, touches[1].y);
                initialScale = scaleFactor;
            } else {
                isPinching = false;
                lastTouches = [...touches];
            }
        }

        function touchMoved() {
            if (isPinching && touches.length === 2) {
                let currentDistance = dist(touches[0].x, touches[0].y, touches[1].x, touches[1].y);
                scaleFactor = initialScale * (currentDistance / initialDistance);
            } else if (!isPinching && touches.length === 1 && lastTouches.length === 1) {
                translateX += touches[0].x - lastTouches[0].x;
                translateY += touches[0].y - lastTouches[0].y;
                lastTouches = [...touches];
            }
        }

        function touchEnded() {
            if (touches.length < 2) {
                isPinching = false;
            }
            lastTouches = [...touches];
        }

        document.getElementById('start-button').addEventListener('click', () => {
            timer = true;
            loop();
            console.log("Start button clicked."); // Debugging step
        });

        document.getElementById('stop-button').addEventListener('click', () => {
            timer = false;
            noLoop();
            pathPoints = [{ x: 400, y: 400 }];
            currentLocation = { x: 400, y: 400 };
            translateX = 0;
            translateY = 0;
            redraw();
            console.log("Stop button clicked."); // Debugging step
        });

        document.getElementById('follow-walk').addEventListener('change', (e) => {
            followWalk = e.target.checked;
            console.log("Follow Walk changed to: " + followWalk); // Debugging step
        });

        document.getElementById('speed-slider').addEventListener('input', (e) => {
            let speed = e.target.value;
            frameRate(map(speed, 0, 100, 1, 60));
            console.log("Speed changed to: " + speed); // Debugging step
        });
    </script>
</body>
</html>
